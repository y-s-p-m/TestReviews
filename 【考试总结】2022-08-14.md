# 生成树

将曼哈顿距离中带的绝对值拆开，找到 $n$ 个点中 $x+y,x-y,y-x,-x-y$ 最大值对应的节点，那么其它的点必然和这四个点连边。

此时形成了四个连通块，两两之间的边权大小就是连通块中的点和另一个连通块代表元的距离最大值

# 数列

happyguy 会 $\Theta(n^2)$ /bx/bx/bx

将残缺的 $b$ 序列建出来一棵树，树上的边表示 $\ge />$ 关系。那么可以设 $f_{x,i}$ 表示 $x$ 子树中所有点赋权值，权值集合大小为 $i$ 的方案数。

归并子树，枚举两个合并后剩下几种权值，方案数可以二项式反演。

# 子串

答案是自动机节点数 $-1$ 再减去 DAG 上出边数量为 $1$ 的节点数量再加上 $i$ 在后缀树根链上出边数量为 $1$ 的点的数量。

对于 DAG 出边数量变化在建 SAM 时计算出来。根链信息使用树状数组维护即可