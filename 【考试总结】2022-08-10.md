# 高三

设 $f_i$ 表示长度为 $i$ 的合法序列数量。尝试枚举最后一个下降序列进行转移。由于接口处的细节问题，所以要容斥。设 $F(x)$ 表示真实计算系数，也就是说 $\displaystyle F(x)=\sum_{i=1}^m x^i$ 。设真正的转移式为 $dp_{i}=\sum_j dp_{j}\binom{K}{i-j}g_{i-j}$ ，那么需要有等式 $\displaystyle\sum_{i=0}^{\infty} G^i(x)=F(x)$

使用多项式求逆求出来 $G(x)$ 之后问题变成了常系数齐次线性递推。使用波斯坦-茉莉算法解决

# 跑路

如果一个队伍人员数量 $>\sqrt n$ 那么可以前缀和后二分。人员数量 $\le \sqrt n$ 的情况对于每种数量计算每个时间的答案（显然时间可以对人员数量取模），前缀和。

乍一看都要带 $\log$ ，但是可以离线询问，将二分定位做前缀和的过程变成先用双指针定位左右端点，在计算前缀和。块大的部分去掉 $\log$ 比较简单，但是块小的部分想去掉 $\log$ 需要并行维护所有余数的前缀和情况，空间复杂度带了根号，不过问题不大

# 摸鱼去

答案是线段端点。

在折线上面等价于在区间中每个线段延展得到的直线所构成的下凸包上面。二分答案，去线段树上查，每个节点二分。三个 $\log$ 。

不过还是可以离线询问，将询问横坐标排序，于是可以直接从前往后弹，插入的总点数是 $\Theta(n\log n)$ ，即使配上二分答案的步骤也少了一个 $\log$

好像可以直接线段树上二分做到单 $\log$